(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[382],{88081:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cp/article",function(){return i(94789)}])},94789:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return ee}});var l=i(85893),n=i(61342),s=i(21676),r=i(21033),a=i(31704),c=i(21248),o=i(39080),d=i(96236),u=i(41533),h=i(37206),x=i(80016),j=i(51233),p=i(53252),m=i(87918),f=i(67294),_=i(37763),y=i.n(_),b=i(4480),v=i(36985),w=i(94951),Z=i(91444),g=i(43584);let k=(0,b.atom)({key:"articleListState",default:[]}),C=(0,b.atom)({key:"articleActiveState",default:null}),S=async e=>{let t=(0,g.$l)(k);return(0,g.z8)(h.RB,!((null==t?void 0:t.length)>0)),await w.JU.readArticlesApi({size:e.size,page:e.page,type:""}).then(e=>{e&&((0,g.z8)(k,e.items),(0,g.z8)(h.f4,e.pages?e.pages:0))}).catch(e=>(Z.Am.error((0,x.t)("failSubmitForm")),Promise.reject(e))).finally(()=>{(0,g.z8)(h.RB,!1)})},z=async(e,t)=>((0,g.z8)(v._,!0),await w.JU.createArticleApi({requestBody:e}).then(()=>{Z.Am.success("Created article successfully"),(0,g.z8)(h.Fx,e=>({...e,refetchData:e.refetchData&&e.refetchData+1})),t()}).catch(()=>{Z.Am.error((0,x.t)("failSubmitForm"))}).finally(()=>{(0,g.z8)(v._,!1)})),A=async(e,t,i)=>((0,g.z8)(v._,!0),await w.JU.updateArticleApi({articleId:e,requestBody:t}).then(()=>{Z.Am.success("Created article successfully"),(0,g.z8)(h.Fx,e=>({...e,refetchData:e.refetchData&&e.refetchData+1})),i()}).catch(()=>{Z.Am.error((0,x.t)("failSubmitForm"))}).finally(()=>{(0,g.z8)(v._,!1)})),T=async e=>((0,g.z8)(v._,!0),await w.JU.deleteArticleApi({articleId:e}).then(e=>{Z.Am.success(e.detail),(0,g.z8)(h.Fx,e=>({...e,refetchData:e.refetchData&&e.refetchData+1}))}).catch(e=>(Z.Am.error((0,x.t)("failSubmitForm")),Promise.reject(e))).finally(()=>{(0,g.z8)(v._,!1)}));var D=i(98312),F=i(42180),R=i(5616),P=i(15861),E=i(20025);let q=()=>{let[e,t]=(0,b.useRecoilState)(u.NS),i=(0,b.useRecoilValue)(C),n=async()=>{await T(i&&(null==i?void 0:i.id)?null==i?void 0:i.id:0),t(!1)};return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(F.Z,{open:e,onClose:()=>{t(!e)},children:(0,l.jsxs)(R.Z,{textAlign:"center",children:[(0,l.jsx)(D.Z,{height:60,width:60,color:E.Z[600]}),(0,l.jsxs)(P.Z,{children:["Do you want delete this article ",(0,l.jsxs)("strong",{children:['"#',(0,x.vX)(null==i?void 0:i.id),'"?']})]}),(0,l.jsxs)(j.Z,{direction:"row",spacing:2,justifyContent:"center",pt:2,children:[(0,l.jsx)(r.Xd,{btnText:"Close",handleClick:()=>{t(!e)}}),(0,l.jsx)(r.$F,{btnText:"Delete",handleClick:n})]})]})})})};var X=i(54348),N=i(32224),V=i(17507),U=i(22651),H=i(92524),J=i(96866),L=i(56543),W=i(35268),$=i(29200),B=i(47533),I=i(87536),O=i(6978),Q=i(16310);let Y=()=>Q.Ry().shape({title_vi:Q.Z_().required("Please enter title"),description_vi:Q.Z_().required("Please enter title"),title_en:Q.Z_().required("Please enter description"),description_en:Q.Z_().required("Please enter description"),type:Q.Z_().required("Please select type")}),K=()=>{let[e,t]=(0,b.useRecoilState)(u.TX),[i,n]=(0,b.useRecoilState)(C),s=(0,b.useRecoilValue)($.X),[a,c]=(0,f.useState)(!0),o=(0,I.cI)({defaultValues:{...i},resolver:(0,B.X)(Y())}),h=()=>{t(!e),n(null),(0,g.z8)(C,null),o.reset()},x=async e=>{i&&(null==i?void 0:i.id)>0?A(i.id,e,h):z(e,h)},p=(0,I.qo)({name:"is_published",control:null==o?void 0:o.control});return(0,f.useEffect)(()=>{c(!0),setTimeout(()=>{c(!1)},1e3)},[s.key]),(0,l.jsx)(F.Z,{open:e,maxWidth:"lg",title:i&&(null==i?void 0:i.id)>0?"Update news & events":"Create news & events",onClose:h,children:(0,l.jsxs)(O.Yb,{onError:d.qp,onSuccess:x,formContext:o,children:[(0,l.jsxs)(j.Z,{pb:9,children:[(0,l.jsx)(N.FE,{}),a?(0,l.jsx)(N.Mi,{}):(0,l.jsxs)(j.Z,{spacing:2,children:[(0,l.jsx)(X.Y,{children:(0,l.jsxs)(j.Z,{spacing:1,children:[(0,l.jsxs)(j.Z,{direction:"row",spacing:2,children:[(0,l.jsx)(H.Z,{form:o,name:"title_".concat(s.key),label:"Title",required:!0}),(0,l.jsx)(R.Z,{width:"100%",children:(0,l.jsxs)(j.Z,{direction:"row",spacing:2,children:[(0,l.jsx)(U.Du,{label:"Type",form:o,name:"type",required:!0,options:d.VV}),(0,l.jsx)(U.xx,{form:o,name:"position",label:"Position",required:!0}),(0,l.jsx)(R.Z,{width:"100%",children:(0,l.jsx)(V.k,{formContent:o,name:"is_published",label:"Status",controlLabel:p?"Published":"Unpublished"})})]})})]}),(0,l.jsxs)(j.Z,{direction:"row",spacing:2,children:[(0,l.jsx)(H.Z,{form:o,name:"description_".concat(s.key),label:"Description",required:!0,rows:7}),(0,l.jsx)(L.f,{formContext:o,name:"thumbnail",label:"Thumbnail"})]})]})}),(0,l.jsx)(J.K,{label:"Content",formContext:o,name:"content_".concat(s.key)})]})]}),(0,l.jsxs)(W.Z,{children:[(0,l.jsx)(r.kw,{color:"inherit",onClick:h,children:"Cancel"}),(0,l.jsx)(r.kw,{type:"submit",children:"Save"})]})]})})},M=[{id:"id",title:"ID",width:10},{id:"thumbnail",title:"Thumbnail"},{id:"title_vi",title:"Title (Vi)"},{id:"title_en",title:"Title (En)"},{id:"type",title:"Type"},{id:"status",title:"Status"},{id:"action",title:"",align:"right"}],G=()=>{let[e,t]=(0,b.useRecoilState)(u.NS),[i,s]=(0,b.useRecoilState)(u.TX),_=(0,b.useRecoilValue)(h.Fx),v=(0,b.useRecoilValue)(k),w=(0,b.useSetRecoilState)(C),Z=e=>{s(!i),w(e)},g=e=>{t(!0),w(e)};(0,f.useEffect)(()=>{S(_)},[_]);let z=(0,l.jsxs)(j.Z,{direction:"row",justifyContent:"space-between",children:[(0,l.jsx)(j.Z,{direction:"row",spacing:2,children:(0,l.jsx)(n.Um,{})}),(0,l.jsx)(r.xl,{btnText:"New article",handleClick:()=>{s(!i),w(null)}})]});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n._i,{headCells:M,maxHeight:"calc(100vh - 230px)",actionHeadProps:z,children:(null==v?void 0:v.length)>0&&v.map((e,t)=>{var i,n,s,r,u;return(0,l.jsxs)(c.T,{onClick:()=>Z(e),onHandleClickDelete:()=>g(e),children:[(0,l.jsx)(p.Z,{children:(0,x.RE)(t)}),(0,l.jsx)(p.Z,{children:(0,l.jsx)(o.F,{src:null!==(i=e.thumbnail)&&void 0!==i?i:"",height:"60px",width:"120px"})}),(0,l.jsx)(p.Z,{children:(0,l.jsx)(y(),{searchWords:[(null==_?void 0:_.keyword)?null==_?void 0:_.keyword:""],textToHighlight:null!==(n=e.title_vi)&&void 0!==n?n:""})}),(0,l.jsx)(p.Z,{children:(0,l.jsx)(y(),{searchWords:[(null==_?void 0:_.keyword)?null==_?void 0:_.keyword:""],textToHighlight:null!==(s=e.title_vi)&&void 0!==s?s:""})}),(0,l.jsx)(p.Z,{children:(0,l.jsx)(m.Z,{label:(0,d.pX)(null!==(r=null==e?void 0:e.type)&&void 0!==r?r:""),size:"small"})}),(0,l.jsx)(p.Z,{children:(0,l.jsx)(a.p,{isPublished:null!==(u=null==e?void 0:e.is_published)&&void 0!==u&&u})})]},e.id)})}),i&&(0,l.jsx)(K,{}),e&&(0,l.jsx)(q,{})]})};function ee(){return(0,f.useEffect)(()=>((0,g.z8)(u.Qb,[{name:"Dashboard",to:"/cp"},{name:"Articles",to:""}]),()=>{(0,g.z8)(u.Qb,[])}),[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.$y,{title:"Article"}),(0,l.jsx)(G,{})]})}ee.Layout=s.hg}},function(e){e.O(0,[937,216,578,737,951,118,888,774,179],function(){return e(e.s=88081)}),_N_E=e.O()}]);